<!DOCTYPE html><html><head>
<title>zoom-canvas - Canvas with Zoom</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.doctools_title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.doctools_toc,UL.doctools_toc UL, UL.doctools_toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.doctools_section, LI.doctools_subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.doctools_example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.doctools_requirements LI, UL.doctools_syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.doctools_synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.doctools_syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.doctools_requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<!-- Generated from file 'zoom-canvas.man' by tcllib/doctools with format 'html'
   -->
<!-- Copyright &amp;copy; 2021, by A.Buratti
   -->
<!-- zoom-canvas.n
   -->
<body><div class="doctools">
<h1 class="doctools_title">zoom-canvas(n) 2.0 zoom-canvas &quot;Canvas with Zoom&quot;</h1>
<div id="name" class="doctools_section"><h2><a name="name">Name</a></h2>
<p>zoom-canvas - a canvas-widget extension</p>
</div>
<div id="toc" class="doctools_section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="doctools_toc">
<li class="doctools_section"><a href="#toc">Table Of Contents</a></li>
<li class="doctools_section"><a href="#synopsis">Synopsis</a></li>
<li class="doctools_section"><a href="#section1">Description</a></li>
<li class="doctools_section"><a href="#section2">Coordinates and Transformations</a></li>
<li class="doctools_section"><a href="#section3">WIDGET OPTIONS</a>
<ul>
<li class="doctools_subsection"><a href="#subsection1">zoom-canvas specific options</a></li>
</ul>
</li>
<li class="doctools_section"><a href="#section4">WIDGET COMMANDS</a>
<ul>
<li class="doctools_subsection"><a href="#subsection2">zoom-canvas specific commands</a></li>
</ul>
</li>
<li class="doctools_section"><a href="#section5">BINDINGS</a></li>
<li class="doctools_section"><a href="#section6">EVENTS</a></li>
<li class="doctools_section"><a href="#section7">Examples</a></li>
<li class="doctools_section"><a href="#section8">Limitations</a></li>
<li class="doctools_section"><a href="#section9">BUGS, IDEAS, FEEDBACK</a></li>
<li class="doctools_section"><a href="#keywords">Keywords</a></li>
<li class="doctools_section"><a href="#category">Category</a></li>
<li class="doctools_section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="doctools_section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="doctools_synopsis">
<ul class="doctools_requirements">
<li>package require <b class="pkgname">Tk 8.6</b></li>
<li>package require <b class="pkgname">zoom-canvas 2.0</b></li>
</ul>
<ul class="doctools_syntax">
<li><a href="#1"><b class="cmd">zoom-canvas</b> <i class="arg">pathName</i> <span class="opt">?<i class="arg">options</i>?</span></a></li>
<li><a href="#2"><i class="arg">pathName</i> <b class="method">create</b> <b class="const">point</b> x y <span class="opt">?<i class="arg">option</i> <i class="arg">value</i>...?</span></a></li>
<li><a href="#3"><i class="arg">pathName</i> <b class="method">zoom</b></a></li>
<li><a href="#4"><i class="arg">pathName</i> <b class="method">zoom</b> <i class="arg">zf</i> <span class="opt">?<i class="arg">Wx</i> <i class="arg">Wy</i>?</span></a></li>
<li><a href="#5"><i class="arg">pathName</i> <b class="method">zoomfit</b> <span class="opt">?<i class="arg">mode</i>?</span> <span class="opt">?<i class="arg">Wx0</i> <i class="arg">Wy0</i> <i class="arg">Wx1</i> <i class="arg">Wy1</i>?</span></a></li>
<li><a href="#6"><i class="arg">pathName</i> <b class="method">rzoom</b> <i class="arg">delta</i> <span class="opt">?<i class="arg">Wx</i> <i class="arg">Wy</i>?</span></a></li>
<li><a href="#7"><i class="arg">pathName</i> <b class="method">overlap</b> <i class="arg">Wx</i> <i class="arg">Wy</i> <i class="arg">Vx</i> <i class="arg">Vy</i></a></li>
<li><a href="#8"><i class="arg">pathName</i> <b class="method">canvasxy</b> <i class="arg">Point</i></a></li>
<li><a href="#9"><i class="arg">pathName</i> <b class="method">W2V</b> <i class="arg">x y <span class="opt">?<i class="arg">x y ...</i>?</span></i></a></li>
<li><a href="#10"><i class="arg">pathName</i> <b class="method">W2V</b> <i class="arg"><i class="arg">coordlist</i></i></a></li>
</ul>
</div>
</div>
<div id="section1" class="doctools_section"><h2><a name="section1">Description</a></h2>
<p><b class="cmd">zoom-canvas</b> is an extension of the standard canvas-widget.</p>
<p><b class="cmd">zoom-canvas</b> is fully compatible with canvas and adds new subcommands to change the <em>zoom-factor</em>
of the whole scene.
In this way, users are no more forced to scale in advance the coordinates of their <em>world-model</em>
so that it fits in the visible part of the canvas.</p>
<p>Users can create,change,move all the graphical primitives (lines, polygons, ovals, ....)
by simply specifying coordinates and distances based on their <em>world coordinate-system</em>,
and then they can control how zoom-canvas scales and translates the whole scene.</p>
<p>It is important to remark that, independently of this <em>apparent scaling</em>,
all the zoom-canvas items maintain their original size and position.</p>
<p>Example</p>
<pre class="doctools_example">
  package require zoom-canvas 2.0
  
  zoom-canvas .zc
  pack .zc -expand true -fill both
  
    # create two huge discs
  .zc create oval -1e6 -1e6  1e6 1e6 -tag DISC_1 -outline red
  .zc create oval -1e7 -1e7  1e7 1e7 -tag DISC_2 -outline green
  ....
    # let zoom-canvas scale/translate the whole scene within the window  
   .zc zoomfit
   ...
    # get the coords of DISC_1
   set disc1_coords [.zc coords DISC_1] 
    # disc1_coords is  {-1e6 -1e6 1e6 1e6}  
  
</pre>
<p>That's all about <b class="cmd">zoom-canvas</b>. Users create and change all the graphical primitives using <em>their world-coordinates</em> and then control how <b class="cmd">zoom-canvas</b> scales and translates the whole scene.</p>
</div>
<div id="section2" class="doctools_section"><h2><a name="section2">Coordinates and Transformations</a></h2>
<p>Normally the origin of the zoom-canvas coordinate-system is at the upper-left corner
of the window containing the canvas (i.e. the Viewport).
By default the y-axis of zoom-canvas is downwards oriented (as for the standard canvas),
but it can set upwards oriented (as in mathematics) by setting the <b class="option">-yaxis</b> option.
to <b class="const">up</b>.</p>
<p>As for the standard canvas-widget, it is possible to adjust the origin of 
the zoom-canvas coordinate-system relative to the Viewport coordinate-system
using the <b class="method">xview</b>/<b class="method">yview</b> subcommands or the <b class="method">scan</b> <b class="const">mark</b>/<b class="const">moveto</b> subcommands; this is typically used for scrolling.</p>
<p><b class="cmd">zoom-canvas</b> also support scaling of the whole scene using the <b class="method">zoom</b>/<b class="method">rzoom</b>/<b class="method">zoomfit</b> subcommands.</p>
<p>The <b class="method">canvasx</b>/<b class="method">canvasx</b> subcommands map the x/y coordinates of the Viewport to the x/y coordinates of zoom-canvas
(i.e. from the Viewport coordinate-system to the World coordinate-System).</p>
<p>The <b class="method">W2V</b> subcommand does the inverse map, from World coordinates to Viewport coordinates.</p>
</div>
<div id="section3" class="doctools_section"><h2><a name="section3">WIDGET OPTIONS</a></h2>
<p><b class="widget">zoom-canvas</b> supports <em>all</em> <b class="widget">canvas</b> options plus the following</p>
<div id="subsection1" class="doctools_subsection"><h3><a name="subsection1">zoom-canvas specific options</a></h3>
<dl class="doctools_options">
<dt><b class="option">-zoommode</b> <i class="arg">mode</i></dt>
<dd><p>by default it is set to <b class="const">xy</b>, meaning that x and y coords will be equally zoomed. 
When this option is set to <b class="const">x</b> or <b class="const">y</b>, then only the x (or the y) coordinate will be zoomed.
This may be useful if you have a long horizontal (or vertical) axes you want to zoom keeping the other dimension unchanged.</p></dd>
<dt><b class="option">-zmultiplier</b> <i class="arg">coeff</i></dt>
<dd><p>Specifies a coefficient used for relative zoom (see <b class="method">rzoom</b>). It should be greater than 1.0. Default is <b class="const">1.4142..</b>. (square root of two)</p></dd>
<dt><b class="option">-yaxis</b> <i class="arg">orientation</i></dt>
<dd><p>Specifies the orientation of the y-axis. <i class="arg">orientation</i> can be <b class="const">up</b> or <b class="const">down</b>. Default value is <b class="const">down</b> as for the standard canvas-widget.
This option can be set only at creation-time, it cannot changed with the <b class="method">configure</b>
widget command.</p></dd>
<dt><b class="option">-pointbmp</b> <i class="arg">xxx</i></dt>
<dd><p>Specifies the default bitmap used for the (new) point items.
Note that argument should be the name of a predefined bitmap (e.g. a bitmap like
&quot;hourglass&quot;, &quot;info&quot;, &quot;quest_head&quot; ... see <b class="cmd">Tk_GetBitmap</b>), or the name
of a file containing a bitmap, in standard X11 or X10 bitmap format.
Filenames must be prefixed by <em>@</em> (e.g. @/mybmps/start.xbm). The predefined
bitmap is @/.../point.xbm, bundled within the package.</p></dd>
<dt><b class="option">-userdata</b> <i class="arg">data</i></dt>
<dd><p>it can be used for storing any kind of data (for storing multiple values, a dictionary data is recommended)</p></dd>
</dl>
</div>
</div>
<div id="section4" class="doctools_section"><h2><a name="section4">WIDGET COMMANDS</a></h2>
<dl class="doctools_definitions">
<dt><a name="1"><b class="cmd">zoom-canvas</b> <i class="arg">pathName</i> <span class="opt">?<i class="arg">options</i>?</span></a></dt>
<dd><p>The <b class="cmd">zoom-canvas</b> command creates a new widget (given by the <i class="arg">pathName</i> argument).
Additional options, described above, may be specified on the command line or in the option database to configure default aspects of the zoom-canvas.
At the time this command is invoked, there must not exist a window named <i class="arg">pathName</i>, but <i class="arg">pathName</i>'s parent must exist. 
The <b class="cmd">zoom-canvas</b> command returns its <i class="arg">pathName</i> argument.</p></dd>
</dl>
<p>Once created, <i class="arg">pathName</i> may be used to invoke all the standard canvas-widget subcommands
plus the following</p>
<div id="subsection2" class="doctools_subsection"><h3><a name="subsection2">zoom-canvas specific commands</a></h3>
<dl class="doctools_definitions">
<dt><a name="2"><i class="arg">pathName</i> <b class="method">create</b> <b class="const">point</b> x y <span class="opt">?<i class="arg">option</i> <i class="arg">value</i>...?</span></a></dt>
<dd><p>Create a point (actually a small bitmap) located at (x,y)
Options are those of canvas-bitmap-item-type. If you omit the <b class="option">-bitmap</b>
option, the default-bitmap is used (see <b class="option">-pointbmp</b> option).</p>
<pre class="doctools_example">
  # create a point at WorldCoord (11,22)
 .zc create point 11 22
  # create a point with a new bitmap
 .zc create point 100 200 -bitmap @/mybmps/special.xbm
  # create a RED point (with default bmp) and then change it to yellow
 set id [.zc create point 200 200 -foreground red]
 .zc itemconfigure $id -foreground yellow
</pre>
</dd>
<dt><a name="3"><i class="arg">pathName</i> <b class="method">zoom</b></a></dt>
<dd><p>Get the current zoom-factor</p></dd>
<dt><a name="4"><i class="arg">pathName</i> <b class="method">zoom</b> <i class="arg">zf</i> <span class="opt">?<i class="arg">Wx</i> <i class="arg">Wy</i>?</span></a></dt>
<dd><p>Set the current zoom-factor. <i class="arg">zf</i> can even be negative (axis directions will be inverted)
but it cannot be 0 (or very close to 0).</p>
<p>(<i class="arg">Wx</i>,<i class="arg">Wy</i>) is the fixed-point of the zoom transformation, i.e. its <em>apparent position</em> does not change. 
If (<i class="arg">Wx</i>,<i class="arg">Wy</i>) is not specified, the fixed-point is the point related to the center of the window.</p>
<p>When this subcommand complets, it generates a virtual event <b class="const">&lt;&lt;Zoom&gt;&gt;</b> for
the purpose of notification, carrying  the actual zoom factor as user_data.
 Binding scripts can access this user_data as the value of the %d substitution.</p></dd>
<dt><a name="5"><i class="arg">pathName</i> <b class="method">zoomfit</b> <span class="opt">?<i class="arg">mode</i>?</span> <span class="opt">?<i class="arg">Wx0</i> <i class="arg">Wy0</i> <i class="arg">Wx1</i> <i class="arg">Wy1</i>?</span></a></dt>
<dd><p>Find and set the best zoom-factor so that all the canvas items (or those enclosed by <i class="arg">Wx0</i> <i class="arg">Wy0</i> <i class="arg">Wx1</i> <i class="arg">Wy1</i>) will be visible.
<i class="arg">mode</i> can be <b class="const">x</b> (best-width) <b class="const">y</b> (best-height) <b class="const">xy</b> (best fit).
Default is <b class="const">xy</b> (best-fit.)</p>
<p>As for the <b class="method">zoom</b> subcommand, this subcommand generates a <b class="const">&lt;&lt;Zoom&gt;&gt;</b> virtual event.</p></dd>
<dt><a name="6"><i class="arg">pathName</i> <b class="method">rzoom</b> <i class="arg">delta</i> <span class="opt">?<i class="arg">Wx</i> <i class="arg">Wy</i>?</span></a></dt>
<dd><p>If <i class="arg">delta</i> is positive, the current zoom-factor is multiplied by the <b class="option">-zmultiplier</b> option's value.
If <i class="arg">delta</i> is negative, the current zoom-factor is divided by the <b class="option">-zmultiplier</b> option's value.
If <i class="arg">delta</i> is 0, no zoom is performed.</p>
<p>(<i class="arg">Wx</i>,<i class="arg">Wy</i>) is the fixed-point of the zoom transformation, i.e. its <em>apparent position</em> does not change. 
If (<i class="arg">Wx</i>,<i class="arg">Wy</i>) is not specified, the fixed-point is the point related to the center of the window.</p>
<p>As for the <b class="method">zoom</b> subcommand, this subcommand generates a <b class="const">&lt;&lt;Zoom&gt;&gt;</b> virtual event.</p></dd>
<dt><a name="7"><i class="arg">pathName</i> <b class="method">overlap</b> <i class="arg">Wx</i> <i class="arg">Wy</i> <i class="arg">Vx</i> <i class="arg">Vy</i></a></dt>
<dd><p>Collimate World-Point <i class="arg">(Wx,Wy)</i> with Viewport-Point <i class="arg">(Vx,Vy)</i>. (Viewport coordinates must be integers).
Items don't change their intrinsic coordinates; it's only a viewport scrolling.</p></dd>
<dt><a name="8"><i class="arg">pathName</i> <b class="method">canvasxy</b> <i class="arg">Point</i></a></dt>
<dd><p>Point is a list of two integers, i.e. a Viewport's point. Result is the corresponding
point in World coords. (this is just a convenience subcommand based on <b class="method">canvasx</b> and <b class="method">canvasy</b>).</p></dd>
<dt><a name="9"><i class="arg">pathName</i> <b class="method">W2V</b> <i class="arg">x y <span class="opt">?<i class="arg">x y ...</i>?</span></i></a></dt>
<dd></dd>
<dt><a name="10"><i class="arg">pathName</i> <b class="method">W2V</b> <i class="arg"><i class="arg">coordlist</i></i></a></dt>
<dd><p>Convert a sequence of x y coords (or a list of x y coords), expressed as WorldCoords,
returning a list with the corresponding Viewport coords.
This may be useful for finding if a point (expressed in world-cordinate) is within the Viewport (i.e. the canvas visibile areaa).
Just test if the returned x-coord is between 0 and [winfo width .zc]
and the returned y.coord is between 0 and [winfo height .zc]</p></dd>
</dl>
</div>
</div>
<div id="section5" class="doctools_section"><h2><a name="section5">BINDINGS</a></h2>
<p><b class="widget">zoom-canvas</b> does not provide built-in bindings, 
but it's easy to add mouse bindings for zooming and panning.</p>
<pre class="doctools_example">
 bind ZoomCanvas &lt;Button-1&gt; { %W scan mark %x %y }
 bind ZoomCanvas &lt;B1-Motion&gt; { %W scan dragto %x %y 1 }
</pre>
<p>If your app is alreading using &lt;Button-1&gt; and &lt;B1-Motion&gt; on canvas,
consider using alternatives mouse-bindings like
&lt;Control-Button-1&gt; &lt;Control-B1-Motion&gt;
or ...  use the scrollbars ! (scrollbars are old-fashioned)</p>
<p>IMPORTANT NOTE on scrolling the viewport (panning):</p>
<p>If no scrollregion is set, then you could move the viewport with no limits. 
If you want to limit the scrolling, you should set the scrollregion
AND be sure the <b class="option">-confine</b> option is set to 1 (this is the default),
like in the following example:</p>
<pre class="doctools_example">
 .zc configure -scrollregion [.zc bbox all]  
</pre>
<p>The following command binds the &lt;MouseWheel&gt; event with the <b class="cmd">rzoom</b> subcommand.
Note that zoom is centered on the cursor position and that the zoom 
coefficient may by adjusted with the <b class="option">-zmultiplier</b>
configuration option.</p>
<pre class="doctools_example">
 bind ZoomCanvas &lt;MouseWheel&gt; { %W rzoom %D [%W canvasx %x] [%W canvasy %y] }
</pre>
</div>
<div id="section6" class="doctools_section"><h2><a name="section6">EVENTS</a></h2>
<p>Event <b class="const">&lt;&lt;Zoom&gt;&gt;</b> is generated when zoom changes.
This virtual-event carries some data that may be caught in binding script by the <b class="const">%d</b> substitution keyword.
Parameter <b class="const">%d</b> holds the new zoom factor</p>
</div>
<div id="section7" class="doctools_section"><h2><a name="section7">Examples</a></h2>
<pre class="doctools_example">
 zoom-canvas .zc -background orange
 pack .zc -fill both -expand true
  #  set the zoom-factor to 0.1x
 .zc zoom 0.1
  # Draw a circle and a rectangle
 .zc create oval 0 0 3000 3000
 .zc create rectangle 0 0 3000 3000
  # Move all items by (500,200) (in world coords)
 .zc move all 500 200
  # note that the 'apparent translation' is only 0.1*(500,200)
  
  # add a binding on mouse movement and print the position (in world-coords)
 bind .zc &lt;Button-1&gt; { puts &quot;You picked [%W canvasxy [list %x %y]]&quot; }
</pre>
<p>You can find many other examples within the &quot;demo&quot; directory of the zoom-canvas package.</p>
<ul class="doctools_itemized">
<li><p>demo/demo.tcl - a basic interactive demo showing the corrispondence between Viewport coordinates and World coordinates.</p></li>
<li><p>demo/toy_planet_demo.tcl  - here the 'world model' is the solar system; planets and their orbits are expressed in kilometers (these are still huge measures..).</p></li>
<li><p>demo/timeline_demo.tcl - here a huge timeline from year 1900 to 2020 can be interactively zoomed, just in the horizontal dimension.</p></li>
</ul>
</div>
<div id="section8" class="doctools_section"><h2><a name="section8">Limitations</a></h2>
<ul class="doctools_itemized">
<li><p>Item-text, item-images and item-windows won't zoom ! (but this could be a benefical limitation, e.g. when drawing a map, text and small images (icons) won't zoom !)</p></li>
<li><p>Line's width (thickness) won't zoom.  (.. same as above)</p></li>
<li><p>Coordinates and distances should be specified as simple numbers; no c,i,m,p suffix is allowed</p></li>
</ul>
</div>
<div id="section9" class="doctools_section"><h2><a name="section9">BUGS, IDEAS, FEEDBACK</a></h2>
<ul class="doctools_itemized">
<li><p>-</p></li>
<li><p>-</p></li>
</ul>
</div>
<div id="keywords" class="doctools_section"><h2><a name="keywords">Keywords</a></h2>
<p>Snit, canvas, widget</p>
</div>
<div id="category" class="doctools_section"><h2><a name="category">Category</a></h2>
<p>widgets</p>
</div>
<div id="copyright" class="doctools_section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2021, by A.Buratti</p>
</div>
</div></body></html>